<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" integrity="sha512-RLEjtaFGdC4iQMJDbMzim/dOvAu+8Qp9sw7QE4wIMYcg2goVoivzwgSZq9CsIxp4xKAZPKh5J2f2lOko2Ze6FQ==" crossorigin=""/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" integrity="sha512-BBToHPBStgMiw0lD4AtkRIZmdndhB6aQbXpX7omcrXeG2PauGBl2lzq2xUZTxaLxYz5IDHlmneCZ1IJ+P3kYtQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js" integrity="sha512-MQlyPV+ol2lp4KodaU/Xmrn+txc1TP15pOBF/2Sfre7MRsA/pB4Vy58bEqe9u7a7DczMLtU5wT8n7OblJepKbg==" crossorigin=""></script>

    <style>
        html, body {
            height: 100%;
            margin: 0;
        }
    </style>
</head>
<body>

<div id="map" style="width: 100%; height: 100%;"></div>
<script>

var baseLayer = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
    maxZoom: 18,
    attribution: 'Base layer &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
    	'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
    id: 'mapbox/light-v10',
    tileSize: 512,
    zoomOffset: -1,
});
var bikeLanesLayerGroup = L.layerGroup([])
var schoolsLayerGroup = L.layerGroup([])

var map = L.map('map', {
    center: [32.7552, -117.1517],
    zoom: 11,
    renderer: L.canvas(),
    layers: [
        baseLayer,
        bikeLanesLayerGroup,
    ],
});

var baseLayers = {
    "Standard": baseLayer,
}
var overlayLayers = {
    "Bike Lanes": bikeLanesLayerGroup,
    "Schools": schoolsLayerGroup,
};
L.control.layers(
    baseLayers,
    overlayLayers,
    {
        // Make the Controls box non-collapsible because we're trying to also use it as a legend.
        collapsed:false,
        hideSingleBase:true
    }
).addTo(map);

// Fetch the bike lanes data and add it to the map once it is loaded.
$.getJSON("layers/current_bike_infrastructure.geojson", function(data) {
    bikeLanesLayer = L.geoJson(data, {
        attribution: 'Bike Lanes &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(bikeLanesLayerGroup);
    bikeLanesLayer.bindPopup("Bike Lanes");
});

// Fetch the schools and add it to the map once it is loaded.
$.getJSON("layers/schools.geojson", function(data) {
    schoolsLayer = L.geoJson(data, {
        attribution: 'Bike Lanes &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    //}).addTo(schoolsLayerGroup);
    });
    var markers = L.markerClusterGroup();
    markers.addLayer(schoolsLayer);
    markers.addTo(schoolsLayerGroup);

    markers.bindPopup(function (layer) {
        if (!('name' in layer.feature.properties)) {
            return '(name unknown)';
	} else {
            return layer.feature.properties.name;
	}
    })
});

</script>

</body>
</html>

